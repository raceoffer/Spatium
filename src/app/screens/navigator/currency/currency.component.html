<app-toolbar
  [label] = "currencyInfo?.name"
  [isColored] = "true"
  [isShadowed] = "true"
  [hasSettings] = "true"
  (backClicked) = "onBack()"
  (settingsClicked) = "onSettingsClicked()"></app-toolbar>

<div class="currency-component box" [ngClass]="{'windows' : isWindows(), 'with-transactions': ((transactions | async) !== null)}" fxLayout="column" fxLayoutAlign="start center">
  <mat-progress-bar
    mode="indeterminate"
    color="accent"
    style="width: 100%; position: fixed; z-index: 2;"
    *ngIf="(currencyWallet?.status | async) === statusType.Synchronizing ||
           (currencyWallet?.balanceStatus | async) === balanceStatusType.Loading">
  </mat-progress-bar>
  <table class="full-width two-columns" style="text-align: left; table-layout: fixed; margin-top: 5px;">
    <tr>
      <td colspan="2">
        <span class="label full-width-label">Account</span>
      </td>
    </tr>
    <tr>
      <td colspan="2" style="margin-bottom: 13px;">
        <div class="field auto-height">
          <div *ngIf="(currencyWallet?.status | async) === statusType.Ready">{{ walletAddress | async }}</div>
          <div *ngIf="(currencyWallet?.status | async) === statusType.Synchronizing">Synchronizing</div>
          <div *ngIf="(currencyWallet?.status | async) === statusType.None ||
                      (currencyWallet?.status | async) === statusType.Cancelled ||
                      (currencyWallet?.status | async) === statusType.Failed">
            Not synched
          </div>
          <button id="copy" class="wallet-address-button" mat-icon-button matSuffix (click)="copy()">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
      </td>
    </tr>
    <tr>
      <td class="right">
        <span class="label" style="margin-left: 5px;">{{ currencyInfo?.symbol }}</span>
      </td>
      <td class="left">
        <span class="label" style="margin-left: 5px;">USD</span>
      </td>
    </tr>
    <tr>
      <td class="right">
        <div class="field disable">
          <span *ngIf="(balanceCurrencyUnconfirmed | async) !== null">
            {{ balanceCurrencyUnconfirmed | async }}
          </span>
          <span *ngIf="(balanceCurrencyUnconfirmed | async) === null">
            {{ (currencyWallet?.balanceStatus | async) === balanceStatusType.Loading ? 'Loading' : '' }}
          </span>
        </div>
      </td>
      <td class="left">
        <div class="field disable">
          <span *ngIf="(balanceUsdUnconfirmed | async) !== null">
            {{ balanceUsdUnconfirmed | async }}
          </span>
          <span *ngIf="(balanceUsdUnconfirmed | async) === null">
            {{ (currencyWallet?.balanceStatus | async) === balanceStatusType.Loading ? 'Loading' : '' }}
          </span>
        </div>
      </td>
    </tr>
    <tr *ngIf="(balanceCurrencyUnconfirmed | async) !== null &&
               (balanceCurrencyUnconfirmed | async) !== (balanceCurrencyConfirmed | async)">
      <td class="right">
        <span class="label" style="margin-left: 5px;">Unconfirmed balance</span>
      </td>
    </tr>
    <tr *ngIf="(currencyWallet?.balanceStatus | async) === balanceStatusType.Error">
      <td class="right">
        <span class="label" style="margin-left: 5px;">Outdated balance</span>
      </td>
    </tr>
  </table>

  <div class="content text-center" fxLayout="column" fxLayoutAlign="start center">
    <div class="qrcode">
      <qr-code [value]="walletAddress | async" [size]="150" [background]="'#f5f5f5'" *ngIf="(walletAddress | async) !== null" ></qr-code>
      <div style="height: 150px" *ngIf="(walletAddress | async) === null"></div>
    </div>

    <mat-list class="text-center transaction-list">
      <mat-list-item class="list-item" [@fadeIn]="''"
                     *ngFor="let transaction of ((transactions | async) || [])"
                     [class.unconfirmed]="!transaction.confirmed">
        <span matLine class="transaction-amount"
              [class.input]="transaction.type==txType.In"
              [class.output]="transaction.type==txType.Out">
          {{ currencyWallet.fromInternal(transaction.amount) }} {{ currencyInfo?.symbol }}
        </span>
        <span matLine class="transaction-time"
              *ngIf="transaction.confirmed"> {{ transaction.time*1000 | date: 'medium' }}</span>
        <span matLine class="transaction-address" *ngIf="transaction.type==txType.In"> {{ transaction.from }} </span>
        <span matLine class="transaction-address" *ngIf="transaction.type==txType.Out"> {{ transaction.to }} </span>
        <mat-divider></mat-divider>
      </mat-list-item>
    </mat-list>
    <div class="content text-center" fxLayout="column" fxLayoutAlign="center center"
         *ngIf="((transactions | async) === null) &&
                ((walletAddress | async) !== null) &&
                ((balanceCurrencyUnconfirmed | async) !== null) &&
                ((balanceUsdUnconfirmed | async) !== null)">
      <mat-spinner
        color="accent"
        [diameter]="50"
        [strokeWidth] = "5">
      </mat-spinner>
    </div>
  </div>

  <div class="footer text-center">
    <button mat-raised-button color="accent" class="width-button-full color full-width" (click)="send()">
      Send
    </button>
  </div>
</div>
